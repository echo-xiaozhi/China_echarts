<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>第一屏</title>
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <script src="echarts/main.min.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/mock.js"></script>
</head>
<body style="width: 100%;height: 100%; margin: 0">
<video class="video_player" autoplay loop muted>
    <source src="video/video3.mp4" type="video/mp4">
</video>
<div id="container" style="height: 100%"></div>
<div class="font-left">四大仓储中心<br/>物流动态路径图</div>
<div class="roll">
    <div class="roll-title">
        <ul>
            <li>地区</li>
            <li>姓名</li>
            <li>订单号</li>
            <li>物流单号</li>
        </ul>
        <div class="clear"></div>
    </div>
    <div class="roll-content">
        <div id="news-container">
            <ul class="roll_list">
            </ul>
        </div>
    </div>
</div>
<div class="video">
    <video class="video_little" autoplay loop muted>
        <source src="video/video3.mp4" type="video/mp4">
    </video>
    <img src="images/video.png" alt="">
</div>
<script type="text/javascript" src="echarts/echarts.min.js"></script>
<script type="text/javascript" src="echarts/china.js"></script>

<script type="text/javascript">
    // 定义所有用到的数据
    var JNData = [];
    var dom = document.getElementById("container");
    var myChart = echarts.init(dom);
    var app = {};
    option = null;
    var map = L.map('container');
    var overlay = new L.echartsLayer3(map, echarts);
    var chartsContainer = overlay.getEchartsContainer();
    var geoCoordMap = {
        '古交市': [115.564066,38.009216],
        '深州市': [115.564066,38.009216],
        '冀州市': [115.588303,37.558459],
        '三河市': [117.082292,39.992521],
        '涿州市': [115.978168,39.49552],
        '迁安市': [118.707606,40.005068],
        '上海市': [121.4648, 31.2891],
        '东莞市': [113.8953, 22.901],
        '东营市': [118.7073, 37.5513],
        '中山市': [113.4229, 22.478],
        '临汾市': [111.4783, 36.1615],
        '临沂市': [118.3118, 35.2936],
        '丹东市': [124.541, 40.4242],
        '丽水市': [119.5642, 28.1854],
        '乌鲁木齐市': [87.9236, 43.5883],
        '佛山市': [112.8955, 23.1097],
        '保定市': [115.0488, 39.0948],
        '兰州市': [103.5901, 36.3043],
        '包头市': [110.3467, 41.4899],
        '北京市': [116.4551, 40.2539],
        '北海市': [109.314, 21.6211],
        '南京市': [118.8062, 31.9208],
        '南宁市': [108.479, 23.1152],
        '南昌市': [116.0046, 28.6633],
        '南通市': [121.1023, 32.1625],
        '厦门市': [118.1689, 24.6478],
        '台州市': [121.1353, 28.6688],
        '合肥市': [117.29, 32.0581],
        '呼和浩特市': [111.4124, 40.4901],
        '咸阳市': [108.4131, 34.8706],
        '哈尔滨市': [127.9688, 45.368],
        '唐山市': [118.4766, 39.6826],
        '嘉兴市': [120.9155, 30.6354],
        '大同市': [113.7854, 39.8035],
        '大连市': [122.2229, 39.4409],
        '天津市': [117.4219, 39.4189],
        '太原市': [112.3352, 37.9413],
        '威海市': [121.9482, 37.1393],
        '宁波市': [121.5967, 29.6466],
        '宝鸡市': [107.1826, 34.3433],
        '宿迁市': [118.5535, 33.7775],
        '常州市': [119.4543, 31.5582],
        '广州市': [113.5107, 23.2196],
        '廊坊市': [116.521, 39.0509],
        '延安市': [109.1052, 36.4252],
        '张家口市': [115.1477, 40.8527],
        '徐州市': [117.5208, 34.3268],
        '德州市': [116.6858, 37.2107],
        '惠州市': [114.6204, 23.1647],
        '成都市': [103.9526, 30.7617],
        '扬州市': [119.4653, 32.8162],
        '承德市': [117.5757, 41.4075],
        '拉萨市': [91.1865, 30.1465],
        '无锡市': [120.3442, 31.5527],
        '日照市': [119.2786, 35.5023],
        '昆明市': [102.9199, 25.4663],
        '杭州市': [119.5313, 29.8773],
        '枣庄市': [117.323, 34.8926],
        '柳州市': [109.3799, 24.9774],
        '株洲市': [113.5327, 27.0319],
        '武汉市': [114.3896, 30.6628],
        '汕头市': [117.1692, 23.3405],
        '江门市': [112.6318, 22.1484],
        '沈阳市': [123.1238, 42.1216],
        '沧州市': [116.8286, 38.2104],
        '河源市': [114.917, 23.9722],
        '泉州市': [118.3228, 25.1147],
        '泰安市': [117.0264, 36.0516],
        '泰州市': [120.0586, 32.5525],
        '济南市': [117.1582, 36.8701],
        '济宁市': [116.8286, 35.3375],
        '海口市': [110.3893, 19.8516],
        '淄博市': [118.0371, 36.6064],
        '淮安市': [118.927, 33.4039],
        '深圳市': [114.5435, 22.5439],
        '清远市': [112.9175, 24.3292],
        '温州市': [120.498, 27.8119],
        '渭南市': [109.7864, 35.0299],
        '湖州市': [119.8608, 30.7782],
        '湘潭市': [112.5439, 27.7075],
        '滨州市': [117.8174, 37.4963],
        '潍坊市': [119.0918, 36.524],
        '烟台市': [120.7397, 37.5128],
        '玉溪市': [101.9312, 23.8898],
        '珠海市': [113.7305, 22.1155],
        '盐城市': [120.2234, 33.5577],
        '盘锦市': [121.9482, 41.0449],
        '石家庄市': [114.4995, 38.1006],
        '福州市': [119.4543, 25.9222],
        '秦皇岛市': [119.2126, 40.0232],
        '绍兴市': [120.564, 29.7565],
        '聊城市': [115.9167, 36.4032],
        '肇庆市': [112.1265, 23.5822],
        '舟山市': [122.2559, 30.2234],
        '苏州市': [120.6519, 31.3989],
        '莱芜市': [117.6526, 36.2714],
        '菏泽市': [115.6201, 35.2057],
        '营口市': [122.4316, 40.4297],
        '葫芦岛市': [120.1575, 40.578],
        '衡水市': [115.8838, 37.7161],
        '衢州市': [118.6853, 28.8666],
        '西宁市': [101.4038, 36.8207],
        '西安市': [109.1162, 34.2004],
        '贵阳市': [106.6992, 26.7682],
        '连云港市': [119.1248, 34.552],
        '邢台市': [114.8071, 37.2821],
        '邯郸市': [114.4775, 36.535],
        '郑州市': [113.4668, 34.6234],
        '鄂尔多斯市': [108.9734, 39.2487],
        '重庆市': [107.7539, 30.1904],
        '金华市': [120.0037, 29.1028],
        '铜川市': [109.0393, 35.1947],
        '银川市': [106.3586, 38.1775],
        '镇江市': [119.4763, 31.9702],
        '长春市': [125.8154, 44.2584],
        '长沙市': [113.0823, 28.2568],
        '长治市': [112.8625, 36.4746],
        '阳泉市': [113.4778, 38.0951],
        '青岛市': [120.4651, 36.3373],
        '韶关市': [113.7964, 24.7028],
        '台北市': [121.435929, 25.171797],
        '香港市': [114.168997, 22.284247],
        '澳门市': [113.543489, 22.198607],
        '辛集市': [115.224453,37.952039],
        '藁城市': [114.861492,37.992149],
        '晋州市': [115.053407,38.039492],
        '新乐市': [114.69456,38.35246],
        '鹿泉市': [114.321452,38.091093],
        '遵化市': [117.96663,40.196857],
        '武安市': [114.207068,36.700172],
        '南宫市': [115.411076,37.364069],
        '沙河市': [114.508899,36.8736],
        '定州市': [114.998224,38.522653],
        '安国市': [115.333408,38.426184],
        '高碑店市': [115.895514,39.33412],
        '泊头市': [116.581182,38.091076],
        '任丘市': [116.10905,38.71915],
        '黄烨市': [117.341519,38.386265],
        '河间市': [116.096429,38.450903],
        '霸州市': [116.401845,39.130471],
        '潞城市': [113.233997,36.342249],
        '晋城市': [112.859727,35.500986],
        '高平市': [112.932139,35.806211],
        '朔州市': [112.439374,39.336664],
        '晋中市': [112.757868,37.695582],
        '介休市': [111.928741,37.028075],
        '运城市': [111.008786,35.036016],
        '永济市': [110.456302,34.875199],
        '河津市': [110.72547,35.605215],
        '忻州市': [110.72547,35.605215],
        '原平市': [112.719214,38.739626],
        '侯马市': [111.375519,35.62959],
        '霍州市': [111.759787,36.576463],
        '吕梁市': [111.148724,37.524499],
        '孝义市': [111.790204,37.153366],
        '汾阳市': [111.791722,37.274506],
        '乌海市': [106.809594,39.663784],
        '赤峰市': [118.902996,42.265104],
        '通辽市': [122.251098,43.662572],
        '霍林郭勒市': [119.667014,45.538724],
        '呼伦贝尔市': [119.767193,49.217693],
        '满洲里市': [117.392334,49.604845],
        '牙克石市': [120.716046,49.290897],
        '扎兰屯市': [122.738707,48.021498],
        '额尔古纳市': [120.18778,50.249236],
        '根河市': [121.529309,50.789057],
        '巴彦淖尔市': [107.39095,40.746734],
        '乌兰察布市': [113.130844,41.005106],
        '丰镇市': [113.111998,40.442245],
        '乌兰浩特市': [122.094451,46.078255],
        '阿尔山市': [119.951804,47.183837],
        '二连浩特市': [111.965841,43.646713],
        '锡林浩特市': [116.087293,43.95661],
        '新民市': [122.85987,42.010112],
        '瓦房店市': [121.990238,39.630073],
        '普兰店市': [121.967953,39.407112],
        '庄河市': [122.968745,39.688288],
        '鞍山市': [122.995047,41.118096],
        '海城市': [122.697322,40.886761],
        '抚顺市': [123.962648,41.886398],
        '本溪市': [123.69251,41.493347],
        '东港市': [124.160185,39.86816],
        '凤城市': [124.070696,40.46401],
        '锦州市': [121.133749,41.102238],
        '凌海市': [121.365414,41.169965],
        '北镇市': [121.789198,41.599606],
        '盖州市': [122.350989,40.404849],
        '大石桥市': [122.514229,40.649488],
        '阜新市': [121.674682,42.028022],
        '辽阳市': [123.242216,41.275897],
        '灯塔市': [123.345458,41.432042],
        '铁岭市': [123.731792,42.232514],
        '调兵山市': [123.58271,42.451603],
        '开原市': [124.045714,42.55293],
        '朝阳市': [120.455771,41.580254],
        '北票市': [120.775325,41.807341],
        '凌源市': [119.407934,41.252518],
        '兴城市': [120.745583,40.623565],
        '九台市': [125.862907,44.157653],
        '榆树市': [126.547082,44.843805],
        '德惠市': [125.732786,44.526751],
        '吉林市': [126.557359,43.844398],
        '蛟河市': [127.34688,43.731672],
        '桦甸市': [126.754213,42.978405],
        '舒兰市': [126.969654,44.412682],
        '磐石市': [126.064314,42.954773],
        '四平市': [124.357058,43.173257],
        '公主岭市': [124.828875,43.510832],
        '双辽市': [123.508285,43.52411],
        '辽源市': [125.151573,42.896169],
        '通化市': [125.94546,41.733816],
        '梅河口市': [125.717605,42.545308],
        '集安市': [126.198431,41.13217],
        '白山市': [126.426753,41.940487],
        '临江市': [126.924586,41.817248],
        '松原市': [124.830905,45.147404],
        '扶余市': [126.057182,44.994168],
        '白城市': [122.847312,45.627119],
        '洮南市': [122.79389,45.339106],
        '大安市': [124.296206,45.515064],
        '延吉市': [129.521668,42.913138],
        '图们市': [129.85096,42.975126],
        '敦化市': [128.235734,43.377453],
        '珲春市': [130.370315,42.86936],
        '龙井市': [129.434937,42.772807],
        '和龙市': [129.017961,42.551898],
        '双城市': [125.888595,44.163552],
        '尚志市': [128.012613,45.215882],
        '五常市': [127.173533,44.93825],
        '齐齐哈尔市': [123.926294,47.359393],
        '讷河市': [124.889978,48.487795],
        '鸡西市': [130.97792,45.301686],
        '虎林市': [132.941166,45.769752],
        '密山市': [131.850659,45.536044],
        '鹤岗市': [130.302133,47.355666],
        '双鸭山市': [131.163617,46.654372],
        '大庆市': [125.106361,46.59522],
        '伊春市': [128.847544,47.733708],
        '铁力市': [128.035493,46.99295],
        '佳木斯市': [130.330233,46.80648],
        '同江市': [132.514058,47.647982],
        '富锦市': [132.045116,47.256715],
        '七台河市': [131.010969,45.776098],
        '牡丹江市': [129.636669,44.557891],
        '绥芬河市': [131.153942,44.418567],
        '海林市': [129.386275,44.600283],
        '宁安市': [129.484766,44.346983],
        '穆棱市': [130.530555,44.926011],
        '黑河市': [127.532038,50.251641],
        '北安市': [126.506003,48.247419],
        '五大连池市': [126.214431,48.523755],
        '绥化市': [126.979382,46.662011],
    };
    var planePath = 'path://M1705.06,1318.313v-89.254l-319.9-221.799l0.073-208.063c0.521-84.662-26.629-121.796-63.961-121.491c-37.332-0.305-64.482,36.829-63.961,121.491l0.073,208.063l-319.9,221.799v89.254l330.343-157.288l12.238,241.308l-134.449,92.931l0.531,42.034l175.125-42.917l175.125,42.917l0.531-42.034l-134.449-92.931l12.238-241.308L1705.06,1318.313z';
    var orderUnitNumMax = 10;
    var orderUnitNumMin = 2;
    var depotNumMax = 4;
    var depotNumMin = 1;
    var timeFrist = 5000;
    var timeLast = 6000;
    function rollList() {
        // 获取仓储中心数组
        var depotData = getDepotData();
        var randomTime = Math.floor(Math.random() * (timeLast - timeFrist) + timeFrist);
        for (var i = 0; i < depotData.length; i++) {
            var orderNum = Math.floor(Math.random() * (orderUnitNumMax - orderUnitNumMin) + orderUnitNumMin);
            var key = "user|" + orderNum;
            var options = {};
            options[key] = [{
                'city': '@city', // 城市名
                'name': '@cfirst()**', // 姓名
                'order': '@natural(10, 40)**@natural(100, 500)', // 订单号
                'number': '@natural(10, 40)***@natural(100, 500)' // 物流单号
            }];
            var data = Mock.mock(options);
            for (var z = 0; z < data.user.length; z++) {
                var str = '<li>\n' +
                    '                    <div><span class="name">' + data.user[z].city + '</span><span>' + data.user[z].name + '</span><span>' + data.user[z].order + '</span><span>' + data.user[z].number + '</span></div>\n' +
                    '                    <div class="clear"></div>\n' +
                    '                </li>';

                var roll = $('.roll_list');
                roll.append(str);
                JNData.push([{name: depotData[i]}, {name: data.user[z].city, value: 95}]);
            }
        }
        refreshData(JNData);
        console.log(JNData.length);
        if (JNData.length > 6) {
            autoscroll('#news-container')
        }
    }
    // 向上滚动
    function autoscroll(obj) {
        //这里的25px是#scrollDiv的高度
        $(obj).find("ul:first").animate({marginTop: "-33px"}, 1000, function () {
            $(this).css("marginTop", "0px").find("li:first").appendTo(this)
        })
        /*$(this).css("marginTop","0px")这里也许会有人搞不明白，为什么又设为0。因为在ul向上移25px的时候，其第一个li会添加到ul的末尾，如果ul的marginTop不设为0的话，整个ul就会慢慢移出它的父盒子，最后使得它的父盒子变空，实现不了原本想要实现的效果。*/
    }

    // 随机返回几个仓库
    function getDepotData() {
        // 随机获取某几个货仓 []
        var cityData = ['济南市', '重庆市', '南京市', '广州市'];
        var depotNum = Math.floor(Math.random() * (depotNumMax - depotNumMin) + depotNumMin);
        var endData = getRandomArrayElements(cityData, depotNum);
        return endData;
    }

    // 随机获取数组中的元素
    function getRandomArrayElements(arr, count) {
        var shuffled = arr.slice(0), i = arr.length, min = i - count, temp, index;
        while (i-- > min) {
            index = Math.floor((i + 1) * Math.random());
            temp = shuffled[index];
            shuffled[index] = shuffled[i];
            shuffled[i] = temp;
        }
        return shuffled.slice(min);
    }



    var convertData = function (data) {
        var res = [];
        for (var i = 0; i < data.length; i++) {
            var dataItem = data[i];
            var fromCoord = geoCoordMap[dataItem[0].name];
            var toCoord = geoCoordMap[dataItem[1].name];
            if (fromCoord && toCoord) {
                res.push([{
                    coord: fromCoord
                }, {
                    coord: toCoord
                }]);
            }
        }
        return res;
    };

    var color = ['#fa7c2a', '#ffffff', '#46bee9'];
    var series = [];

    var refreshData = function (node) {
        //更新数据
        var option = myChart.getOption();
        option.series = [
            {
                // name: item[0] + ' Top10',
                type: 'lines',
                zlevel: 1,
                effect: {
                    show: true,
                    period: 6,
                    trailLength: 0.7,
                    color: '#fb7c29',
                    symbolSize: 3,
                    loop: false,
                },
                lineStyle: {
                    normal: {
                        color: '#fb7c29',
                        width: 0,
                        curveness: 0.2,
                        opacity: 0
                    }
                },
                data: convertData(node)
            },
            {
                // name: item[0] + ' Top10',
                type: 'lines',
                zlevel: 2,
                effect: {
                    show: true,
                    period: 6,
                    trailLength: 0,
                    symbol: planePath,
                    symbolSize: 15,
                    loop: false
                },
                lineStyle: {
                    normal: {
                        color: '#fb7c29',
                        width: 1,
                        opacity: 0.4,
                        curveness: 0.2
                    }
                },
                data: convertData(node),
            },
            {
                // name: item[0] + ' Top10',
                type: 'effectScatter',
                coordinateSystem: 'geo',
                zlevel: 2,
                rippleEffect: {
                    brushType: 'stroke',
                    loop: false
                },
                label: {
                    normal: {
                        show: true,
                        position: 'right',
                        formatter: '{b}'
                    }
                },
                // symbolSize: function (val) {
                //     return val / 8;
                // },
                itemStyle: {
                    normal: {
                        color: '#fb7c29'
                    }
                },
                // data: node.map(function (dataItem) {
                //     return {
                //         name: dataItem.name,
                //         // value: geoCoordMap[dataItem[1].name].concat([dataItem[1].value])
                //     };
                // })
            }];
        myChart.setOption(option,true);
    };
    option = {
        title: {
            // text: '测试',
            x: 'center',
            textStyle: {
                color: '#fff'
            }
        },
        tooltip: {
            trigger: 'item',
            formatter: function (params) {
                return params.name + ' : ' + params.value[2];
            }
        },
        tooltip: {
            trigger: 'item'
        },
        // legend: {
        //     orient: 'vertical',
        //     top: 'bottom',
        //     left: 'left',
        //     data: ['济南 Top10', '重庆 Top10', '南京 Top10', '广州 Top10'],
        //     textStyle: {
        //         color: '#fff'
        //     },
        //     selectedMode: 'single'
        // },
        geo: {
            map: 'china',
            left: 319,
            top: 26,
            width: 1385,
            height: 1020,
            label: {
                emphasis: {
                    show: false
                }
            },
            itemStyle: {
                emphasis: {
                    areaColor: '#2a333d',
                    borderWidth: 0
                },
                opacity: 0.8
            },
            regions: [{
                name: '北京',
                itemStyle: {
                    areaColor: '#06487a',
                    borderWidth: 0
                }
            }, {
                name: '山东',
                itemStyle: {
                    areaColor: '#042161',
                    borderWidth: 0
                }
            }, {
                name: '黑龙江',
                itemStyle: {
                    areaColor: '#0c8a9e',
                    borderWidth: 0
                }
            }, {
                name: '内蒙古',
                itemStyle: {
                    areaColor: '#096a8e',
                    borderWidth: 0
                }
            }, {
                name: '吉林',
                itemStyle: {
                    areaColor: '#0b809a',
                    borderWidth: 0
                }
            }, {
                name: '辽宁',
                itemStyle: {
                    areaColor: '#05366b',
                    borderWidth: 0
                }
            }, {
                name: '河北',
                itemStyle: {
                    areaColor: '#042a64',
                    borderWidth: 0
                }
            }, {
                name: '天津',
                itemStyle: {
                    areaColor: '#0a7897',
                    borderWidth: 0
                }
            }, {
                name: '陕西',
                itemStyle: {
                    areaColor: '#064075',
                    borderWidth: 0
                }
            }, {
                name: '山西',
                itemStyle: {
                    areaColor: '#08658c',
                    borderWidth: 0
                }
            }, {
                name: '宁夏',
                itemStyle: {
                    areaColor: '#0c8fa8',
                    borderWidth: 0
                }
            }, {
                name: '新疆',
                itemStyle: {
                    areaColor: '#0c8da4',
                    borderWidth: 0
                }
            }, {
                name: '青海',
                itemStyle: {
                    areaColor: '#0c96ae',
                    borderWidth: 0
                }
            }, {
                name: '甘肃',
                itemStyle: {
                    areaColor: '#0b82a1',
                    borderWidth: 0
                }
            }, {
                name: '河南',
                itemStyle: {
                    areaColor: '#031f5f',
                    borderWidth: 0
                }
            }, {
                name: '湖北',
                itemStyle: {
                    areaColor: '#096a8f',
                    borderWidth: 0
                }
            }, {
                name: '湖南',
                itemStyle: {
                    areaColor: '#085f85',
                    borderWidth: 0
                }
            }, {
                name: '四川',
                itemStyle: {
                    areaColor: '#06527f',
                    borderWidth: 0
                }
            }, {
                name: '广东',
                itemStyle: {
                    areaColor: '#06527f',
                    borderWidth: 0
                }
            }, {
                name: '海南',
                itemStyle: {
                    areaColor: '#0b7d96',
                    borderWidth: 0
                }
            }, {
                name: '台湾',
                itemStyle: {
                    areaColor: '#0a7d9a',
                    borderWidth: 0
                }
            }, {
                name: '福建',
                itemStyle: {
                    areaColor: '#03205c',
                    borderWidth: 0
                }
            }, {
                name: '上海',
                itemStyle: {
                    areaColor: '#0a7997',
                    borderWidth: 0
                }
            }, {
                name: '西藏',
                itemStyle: {
                    areaColor: '#0c91a6',
                    borderWidth: 0
                }
            }, {
                name: '香港',
                itemStyle: {
                    areaColor: '#031c58',
                    borderWidth: 0
                }
            }, {
                name: '江苏',
                itemStyle: {
                    areaColor: '#061e5d',
                    borderWidth: 0
                }
            }, {
                name: '安徽',
                itemStyle: {
                    areaColor: '#053b70',
                    borderWidth: 0
                }
            }, {
                name: '浙江',
                itemStyle: {
                    areaColor: '#074977',
                    borderWidth: 0
                }
            }, {
                name: '江西',
                itemStyle: {
                    areaColor: '#096c8d',
                    borderWidth: 0
                }
            }, {
                name: '重庆',
                itemStyle: {
                    areaColor: '#096d90',
                    borderWidth: 0
                }
            }, {
                name: '贵州',
                itemStyle: {
                    areaColor: '#0b7997',
                    borderWidth: 0
                }
            }, {
                name: '广西',
                itemStyle: {
                    areaColor: '#074875',
                    borderWidth: 0
                }
            }, {
                name: '云南',
                itemStyle: {
                    areaColor: '#096b8c',
                    borderWidth: 0
                }
            }]
        },
        series: series
    };
    if (option && typeof option === "object") {
        myChart.setOption(option, true);
    }
    function setRandomTime() {
        var randomTime = Math.floor(Math.random() * (timeLast - timeFrist) + timeFrist);
        return randomTime;
    }

    function start() {
        let str = setRandomTime();

        time1 = setInterval(function () {
            // setTimeout(timeFun())
            rollList();
            clearInterval(time1);
            start()
        }, str);
    }

    start()

</script>
</body>
</html>