<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>第三屏</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="echarts/echarts.min.js"></script>
    <script src='echarts/echarts-liquidfill.min.js'></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/index.js"></script>
</head>
<body>
<video class="video_player" autoplay loop muted>
    <source src="video/video3.mp4" type="video/mp4" >
</video>
<div class="food">
    <div class="food_title">今日外卖总订单数：</div>
    <div class="food_num">

    </div>
    <div class="food_font">单</div>
</div>
<div class="money">
    <div class="money_title">今日外卖营业总额：</div>
    <div class="money_num">

    </div>
    <div class="money_font">元</div>
</div>

<div class="chart"></div>
<div class="bool_font">外卖销售占比</div>

<div class="form">
    <div class="form_title">
        <div class="form_title_big">整体营业月度趋势图</div>
        <div class="form_title_little">
            <img src="images/blue.png" alt="">
            店面销售总额
        </div>
        <div class="form_title_little">
            <img src="images/orange.png" alt="">
            外卖平台销售总额
        </div>
    </div>
    <div class="form_form" id="container"></div>
</div>
<div class="day">
    <div class="day_title">
        <ul>
            <li style="width: 81px;">排序</li>
            <li class="li_center">店铺名称</li>
            <li style="width: 125px;">日销售额</li>
        </ul>
    </div>
    <div class="day_list">

    </div>
</div>
<div class="hots">
    <div class="hots_title">
        <ul>
            <li style="width: 81px;">排序</li>
            <li class="li_center">商品名称</li>
            <li style="width: 125px;">日销售额</li>
        </ul>
    </div>
    <div class="hots_list">

    </div>
</div>
<div class="videos">
    <div class="videos_list">
        <video class="videos_little" autoplay loop muted>
            <source src="video/video3.mp4" type="video/mp4" >
        </video>
        <img src="images/videos.png" alt="">
    </div>
    <div class="videos_list">
        <video class="videos_little" autoplay loop muted>
            <source src="video/video3.mp4" type="video/mp4" >
        </video>
        <img src="images/videos.png" alt="">
    </div>
    <div class="videos_list">
        <video class="videos_little" autoplay loop muted>
            <source src="video/video3.mp4" type="video/mp4" >
        </video>
        <img src="images/videos.png" alt="">
    </div>
    <div class="videos_list">
        <video class="videos_little" autoplay loop muted>
            <source src="video/video3.mp4" type="video/mp4" >
        </video>
        <img src="images/videos.png" alt="">
    </div>
</div>
<script>
    var foodInitMoney = 0;
    var hotInitMoney = 0;
    var takeFoodData = [
        {name: '贝克汉堡（0053号店）', value: foodInitMoney},
        {name: '壹點壹（0073号店）', value: foodInitMoney},
        {name: '柠檬工坊（0027号店）', value: foodInitMoney},
        {name: '让爱翻滚（0085号店）', value: foodInitMoney},
        {name: '张一碗（0157号店）', value: foodInitMoney},
        {name: '锅先森（0138号店）', value: foodInitMoney},
        {name: '米姑娘（0082号店）', value: foodInitMoney},
        {name: '瓦罐香沸（0194号店）', value: foodInitMoney},
        {name: '姥娘包子（0046号店）', value: foodInitMoney},
        {name: '贝克汉堡（0037号店）', value: foodInitMoney},
        {name: '壹點壹（0053号店）', value: foodInitMoney},
        {name: '柠檬工坊（0051号店）', value: foodInitMoney},
        {name: '让爱翻滚（0047号店）', value: foodInitMoney},
        {name: '张一碗（0063号店）', value: foodInitMoney},
        {name: '锅先森（0089号店）', value: foodInitMoney},
        {name: '米姑娘（0072号店）', value: foodInitMoney},
        {name: '瓦罐香沸（0086号店）', value: foodInitMoney},
        {name: '贝克汉堡（0074号店）', value: foodInitMoney},
        {name: '壹點壹（0060号店）', value: foodInitMoney},
        {name: '柠檬工坊（0095号店）', value: foodInitMoney},
        {name: '让爱翻滚（0091号店）', value: foodInitMoney},
        {name: '张一碗（0040号店）', value: foodInitMoney},
        {name: '锅先森（0059号店）', value: foodInitMoney},
        {name: '米姑娘（0099号店）', value: foodInitMoney},
        {name: '贝克汉堡（0047号店）', value: foodInitMoney},
        {name: '壹點壹（0160号店）', value: foodInitMoney},
        {name: '柠檬工坊（0058号店）', value: foodInitMoney},
        {name: '让爱翻滚（0066号店）', value: foodInitMoney},
        {name: '张一碗（0079号店）', value: foodInitMoney},
        {name: '锅先森（0105号店）', value: foodInitMoney},
        {name: '贝克汉堡（0170号店）', value: foodInitMoney},
        {name: '壹點壹（0070号店）', value: foodInitMoney},
        {name: '柠檬工坊（0093号店）', value: foodInitMoney},
        {name: '让爱翻滚（0056号店）', value: foodInitMoney},
        {name: '张一碗（0089号店）', value: foodInitMoney},
        {name: '锅先森（0152号店）', value: foodInitMoney},
        {name: '贝克汉堡（0136号店）', value: foodInitMoney},
        {name: '壹點壹（0153号店）', value: foodInitMoney},
        {name: '张一碗（0119号店）', value: foodInitMoney},
        {name: '锅先森（0042号店）', value: foodInitMoney},
    ];
    var takeHotData = [
        {name: '招牌金汤米线套餐', value: hotInitMoney},
        {name: '招牌金汤米线', value: hotInitMoney},
        {name: '原味鸡腿堡', value: hotInitMoney},
        {name: '泡菜过桥米线套餐', value: hotInitMoney},
        {name: '原味过桥米线', value: hotInitMoney},
        {name: '壹點壹香香鸡', value: hotInitMoney},
        {name: '壹點壹香辣鸡翅', value: hotInitMoney},
        {name: '黑金鸡块', value: hotInitMoney},
        {name: '扬州炒饭', value: hotInitMoney},
        {name: '香辣鸡腿堡', value: hotInitMoney},
        {name: '瓦罐红烧肉套餐', value: hotInitMoney},
        {name: '台式香辣排骨', value: hotInitMoney},
        {name: '台式香菇滑鸡', value: hotInitMoney},
        {name: '台式卤肉饭', value: hotInitMoney},
        {name: '台式黑椒鸡翅', value: hotInitMoney},
        {name: '台式干锅鸭', value: hotInitMoney},
        {name: '酸汤鱼', value: hotInitMoney},
        {name: '酸辣过桥米线套餐', value: hotInitMoney},
        {name: '酸菜过桥米线', value: hotInitMoney},
        {name: '排骨大包', value: hotInitMoney},
        {name: '糯米丸子', value: hotInitMoney},
        {name: '柠檬水', value: hotInitMoney},
        {name: '咖喱蒸鸡', value: hotInitMoney},
        {name: '咖喱脆骨炒饭', value: hotInitMoney},
        {name: '金桔柠檬', value: hotInitMoney},
        {name: '金桔蜜柚', value: hotInitMoney},
        {name: '酱肉大包', value: hotInitMoney},
        {name: '鸡腿堡套餐', value: hotInitMoney},
        {name: '黄金酸辣米线', value: hotInitMoney},
        {name: '黑椒蒸排骨', value: hotInitMoney},
        {name: '甘梅地瓜条', value: hotInitMoney},
        {name: '蜂蜜柚子茶', value: hotInitMoney},
        {name: '番茄过桥米线', value: hotInitMoney},
        {name: '豉汁排骨', value: hotInitMoney},
        {name: '菠萝腰果炒饭', value: hotInitMoney},
        {name: '碧海蓝天', value: hotInitMoney},
        {name: '全家福大包', value: hotInitMoney},
        {name: '爆汁脆脆鸡', value: hotInitMoney},
        {name: '白灼西兰花', value: hotInitMoney},
        {name: '奥尔良烤鸡腿堡', value: hotInitMoney},
    ];
    var minShopMoney = 60;
    var maxShopMoney = 200;
    var minGoodMoney = 90;
    var maxGoodMoney = 300;
    var minSecond = 10000;
    var maxSecond = 20000;
    var dayList = $('.day_list');
    var hotsList = $('.hots_list');
    var randomNumMax = 5;
    var randomNumMix = 1;
    var randomOrderMax = 100;
    var randomOrderMix = 80;
    var timeListMoney = [
        {time: 0, moeny: 0},
        {time: 1, moeny: 0},
        {time: 2, moeny: 0},
        {time: 3, moeny: 0},
        {time: 4, moeny: 0},
        {time: 5, moeny: 512},
        {time: 6, moeny: 5633},
        {time: 7, moeny: 31239},
        {time: 8, moeny: 82451},
        {time: 9, moeny: 159269},
        {time: 10, moeny: 160805},
        {time: 11, moeny: 186411},
        {time: 12, moeny: 1210656},
        {time: 13, moeny: 1466717},
        {time: 14, moeny: 1517929},
        {time: 15, moeny: 1524075},
        {time: 16, moeny: 1526635},
        {time: 17, moeny: 1528171},
        {time: 18, moeny: 1620353},
        {time: 19, moeny: 2030051},
        {time: 20, moeny: 2542174},
        {time: 21, moeny: 2567782},
        {time: 22, moeny: 2569316},
        {time: 23, moeny: 2569827},
    ];
    var peakData = [10, 13];
    var thirdPeakData = [13.1, 17];
    var secondPeakData = [17.1, 20];
    var minPercent = 0.28;
    var maxPercent = 0.32;

    var myDate = new Date();
    var hours = myDate.getHours(); //获取当前小时数(0-23)
    var timeMoney = timeListMoney[hours].moeny;
    // 获取到当前时刻应该有的钱数
    var foodAllMoney = Math.round(timeMoney * 0.4), hotAllMoney = Math.round(timeMoney * 0.6);
    // 随机分配给每个店铺，每个商品
    var takeFoodLength = takeFoodData.length, takeHotLength = takeHotData.length;
    // 定义初始值
    for (i = 0; i < takeFoodLength; i++) {
        var randomMoney = Math.floor(Math.random() * foodAllMoney * 0.1);
        foodAllMoney -= randomMoney;
        var value = takeFoodData[i];
        value.value = randomMoney;
        takeFoodData.splice(i, 1, value);
    }
    for (i = 0; i < takeHotLength; i++) {
        var randomMoney = Math.floor(Math.random() * hotAllMoney * 0.1);
        hotAllMoney -= randomMoney;
        var value = takeHotData[i];
        value.value = randomMoney;
        takeHotData.splice(i, 1, value);
    }
    // 判断此时小时是否在某个区间内
    function inHours(arr, hours) {
        if (hours >= arr[0] && hours <= arr[1]) {
            return true;
        }
        return false;
    }

    //随机获取几个
    function getRandomNum(){
        var randomNum = Math.floor(Math.random() * (randomNumMax - randomNumMix) + randomNumMix);
        return randomNum;
    }
    //得到店铺随机钱数
    function getFoodRandomNum() {
        var startHours = myDate.getHours();
        if (inHours(peakData, startHours)) {
            var minShopMoney = 180;
            var maxShopMoney = 600;
        }
        if (inHours(secondPeakData, startHours)) {
            var minShopMoney = 120;
            var maxShopMoney = 400;
        }
        if (inHours(thirdPeakData, startHours)) {
            var minShopMoney = 90;
            var maxShopMoney = 300;
        }
        var randomNum = Math.floor(Math.random() * (maxShopMoney - minShopMoney) + minShopMoney);
        return randomNum;
    }

    //得到商品随机钱数
    function getHotRandomNum() {
        var minGoodMoney = 90;
        var maxGoodMoney = 300;
        var startHours = myDate.getHours();
        if (inHours(peakData, startHours)) {
            var minGoodMoney = 270;
            var maxGoodMoney = 900;
        }
        if (inHours(secondPeakData, startHours)) {
            var minGoodMoney = 180;
            var maxGoodMoney = 600;
        }
        if (inHours(thirdPeakData, startHours)) {
            var minGoodMoney = 135;
            var maxGoodMoney = 450;
        }
        var randomNum = Math.floor(Math.random() * (maxGoodMoney - minGoodMoney) + minGoodMoney);
        return randomNum;
    }

    // 从数组中取出某几个元素 取出值删除原数组值 重新合并到原数组
    function getRandomArrayElementsFood(arr, count) {
        var shuffled = arr.slice(0), i = arr.length, min = i - count, temp, index;
        while (i-- > min) {
            index = Math.floor((i + 1) * Math.random());
            temp = shuffled[index];
            arr.splice(index, 1);
            shuffled[index] = shuffled[i];
            shuffled[i] = temp;
        }
        var randomData = shuffled.slice(min);

        for (var z = 0; z < randomData.length; z++) {
            var name = randomData[z].name;
            var endValue = randomData[z].value + getFoodRandomNum();
            var endArr = {name: name, value: endValue};
            randomData.splice(z, 1, endArr);
            arr.push(randomData[z]);
        }
        return arr;
    }
    // 从数组中取出某几个元素 取出值删除原数组值 重新合并到原数组
    function getRandomArrayElementsHot(arr, count) {
        var shuffled = arr.slice(0), i = arr.length, min = i - count, temp, index;
        while (i-- > min) {
            index = Math.floor((i + 1) * Math.random());
            temp = shuffled[index];
            arr.splice(index, 1);
            shuffled[index] = shuffled[i];
            shuffled[i] = temp;
        }
        var randomData = shuffled.slice(min);

        for (var z = 0; z < randomData.length; z++) {
            var name = randomData[z].name;
            var endValue = randomData[z].value + getHotRandomNum();
            var endArr = {name: name, value: endValue};
            randomData.splice(z, 1, endArr);
            arr.push(randomData[z]);
        }
        return arr;
    }

    //最终数组写入页面 商店
    function insertFoodPage(data) {
        var Temp = 0;
        var length = data.length;
        for (var i = 0; i < length; i++) {
            for (var j = i + 1; j < length; j++) {
                if (data[i].value < data[j].value) {
                    Temp = data[i];
                    data[i] = data[j];
                    data[j] = Temp;
                }
            }
        }
        dayList.html('');
        for (z = 0; z < data.length; z++) {
            var str = '<ul>\n' +
                '            <li style="width: 81px;"><span>' + (z + 1) + '</span></li>\n' +
                '            <li class="li_center">' + data[z].name + '</li>\n' +
                '            <li>¥' + data[z].value + '</li>\n' +
                '        </ul>';
            dayList.append(str);
        }
    }

    //最终数组写入页面 商品
    function insertHotPage(data) {
        var Temp = 0;
        var length = data.length;
        for (var i = 0; i < length; i++) {
            for (var j = i + 1; j < length; j++) {
                if (data[i].value < data[j].value) {
                    Temp = data[i];
                    data[i] = data[j];
                    data[j] = Temp;
                }
            }
        }
        hotsList.html('');
        for (z = 0; z < data.length; z++) {
            var str = '<ul>\n' +
                '            <li style="width: 81px;"><span>' + (z + 1) + '</span></li>\n' +
                '            <li class="li_center">' + data[z].name + '</li>\n' +
                '            <li>¥' + data[z].value + '</li>\n' +
                '        </ul>';
            hotsList.append(str);
        }
    }

    // 得到随机数组，赋值，重新写入 商店
    function handleFood(data) {
        var randomNum = getRandomNum();
        var arr = getRandomArrayElementsFood(data, randomNum);
        insertFoodPage(arr);
    }

    // 得到随机数组，赋值，重新写入 商品
    function handleHot(data) {
        var randomNum = getRandomNum();
        var arr = getRandomArrayElementsHot(data, randomNum);
        insertHotPage(arr);
    }

    // 随机秒数
    function setRandomTime() {
        var startHours = myDate.getHours();
        if (inHours(peakData, startHours)) {
            var minSecond = 7000;
            var maxSecond = 17000;
        }
        if (inHours(secondPeakData, startHours)) {
            var minSecond = 8000;
            var maxSecond = 18000;
        }
        if (inHours(thirdPeakData, startHours)) {
            var minSecond = 9000;
            var maxSecond = 19000;
        }
        var randomTime = Math.floor(Math.random() * (maxSecond - minSecond) + minSecond);
        return randomTime;
    }

    // 先把原始数据添加进去 商店
    for (z = 0; z < takeFoodData.length; z++) {
        var str = '<ul>\n' +
            '            <li style="width: 81px;"><span>' + (z + 1) + '</span></li>\n' +
            '            <li class="li_center">' + takeFoodData[z].name + '</li>\n' +
            '            <li>¥' + takeFoodData[z].value + '</li>\n' +
            '        </ul>';
        dayList.append(str);
    }

    // 先把原始数据添加进去 商品
    for (z = 0; z < takeHotData.length; z++) {
        var str = '<ul>\n' +
            '            <li style="width: 81px;"><span>' + (z + 1) + '</span></li>\n' +
            '            <li class="li_center">' + takeHotData[z].name + '</li>\n' +
            '            <li>¥' + takeHotData[z].value + '</li>\n' +
            '        </ul>';
        hotsList.append(str);
    }

    var bgColor = '#000000';
    var containers = document.getElementsByClassName('chart');
    var options = [{
        series: [{
            type: 'liquidFill',
            data: [0.3,{
                value: 0.35,
                direction: 'left',
                itemStyle: {
                    normal: {
                        color: '#07349e',
                    }
                }
            }],
            color:['#02192d'],
            radius: '100%',
            outline: {
                show: false
            },
            backgroundStyle: {
                opacity: 0
            },
            label:{
                color: '#ffffff',
                fontSize: 43,
                fontFamily: 'gb'
            }
        }]
    }];
    var charts = [];
    for (var i = 0; i < options.length; ++i) {
        var chart = echarts.init(containers[i]);
        if (i > 0) {
            options[i].series[0].silent = true;
        }
        chart.setOption(options[i]);
        chart.setOption({
            baseOption: options[i],
            media: [{
                query: {
                    maxWidth: 300
                },
                option: {
                    series: [{
                        label: {
                            fontSize: 50
                        }
                    }]
                }
            }]
        });
        charts.push(chart);
    }
    function togther() {
        var time = setRandomTime();
        time1 = setInterval(function () {
            handleFood(takeFoodData);
            handleHot(takeHotData);
            clearInterval(time1);
            togther();
        },time);

        var foodResult = 0;
        for(var i = 0; i < takeFoodData.length; i++) {
            foodResult += takeFoodData[i].value;
        }
        var hotResult = 0;
        for(var i = 0; i < takeHotData.length; i++) {
            hotResult += takeHotData[i].value;
        }

        var num = foodResult + hotResult;
        $(".money_num").rollNum({
            deVal: num,
            digit: 7
        });
        var foodNum = Math.round(num / 30);
        $(".food_num").rollNum({
            deVal: foodNum,
            digit: 5
        });

        var percent = Math.random() * (maxPercent - minPercent) + minPercent;
        var secondPercent = percent + 0.05;
        options = [{
            series: [{
                data: [percent,{
                    value: secondPercent,
                    direction: 'left',
                    itemStyle: {
                        normal: {
                            color: '#07349e',
                        }
                    }
                }]
            }],
        }];
        for (var i = 0; i < options.length; ++i) {
            chart.setOption(options[i]);
        }
    }

    togther();


    var dom = document.getElementById("container");
    var myChart = echarts.init(dom);
    var app = {};
    option = null;
    var dataAxis = ['9月', '10月', '11月', '12月', '1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月'];
    var data = [3317.5, 3851.8, 3675.5, 3689.2, 1950, 2000, 3098.6, 3024.5, 3320.7, 3400.6, 3343.2, 3516.1, 3446.9, 2885.9];
    var yMax = 4000;
    var dataShadow = [];

    for (var i = 0; i < data.length; i++) {
        dataShadow.push(yMax);
    }

    option = {
        xAxis: {
            data: dataAxis,
            axisLabel: {
                // inside: true,
                textStyle: {
                    color: '#ffffff'
                }
            },
            axisTick: {
                show: false
            },
            axisLine: {
                show: false
            },
            z: 10
        },
        yAxis: {
            axisLine: {
                show: false
            },
            axisTick: {
                show: false
            },
            axisLabel: {
                textStyle: {
                    color: '#ffffff'
                }
            },
            splitLine: {
                show: false
            }
        },
        // dataZoom: [
        //     {
        //         type: 'inside'
        //     }
        // ],
        series: [
            { // For shadow
                type: 'bar',
                itemStyle: {
                    normal: {color: 'rgba(0,0,0,0.05)'}
                },
                barGap:'-100%',
                barCategoryGap:'40%',
                data: dataShadow,
                // animation: false,
                fontSize: 16
            },
            {
                type: 'bar',
                itemStyle: {
                    normal: {
                        color: new echarts.graphic.LinearGradient(
                            0, 0, 0, 1,
                            [
                                {offset: 0, color: '#fb5723'},
                                {offset: 0.3, color: '#0e9391'},
                                {offset: 1, color: '#15fcf8'}
                            ]
                        ),
                        opacity: 0.9
                    },
                    // emphasis: {
                    //     color: new echarts.graphic.LinearGradient(
                    //         0, 0, 0, 1,
                    //         [
                    //             {offset: 0, color: '#15fcf8'},
                    //             {offset: 0.3, color: '#0e9391'},
                    //             {offset: 1, color: '#fb5723'}
                    //         ]
                    //     )
                    // },
                },
                data: data,
                fontSize: 16
            }
        ]
    };

    // Enable data zoom when user click bar.
    var zoomSize = 6;
    myChart.on('click', function (params) {
        console.log(dataAxis[Math.max(params.dataIndex - zoomSize / 2, 0)]);
        myChart.dispatchAction({
            type: 'dataZoom',
            startValue: dataAxis[Math.max(params.dataIndex - zoomSize / 2, 0)],
            endValue: dataAxis[Math.min(params.dataIndex + zoomSize / 2, data.length - 1)]
        });
    });;
    if (option && typeof option === "object") {
        myChart.setOption(option, true);
    }
</script>
</body>
</html>